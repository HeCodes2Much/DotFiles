#!/usr/bin/env bash
updates() {
    configFile=$HOME/.config/repowm/repobar/bar_updates.ini

    timestamp=$(date +%s)
    icon=" î‚ª"
    [[ -f $configFile ]] && . $configFile
    if [ -z "$LastUsed" ] || [ -z "$Message" ]; then
        updates=$(yay -Pn)
        if [ "$updates" -eq "0" ]; then
            updatecount="No Updates"
        elif [ "$updates" -ge "1" ]; then
            updatecount="$updates Update"
        else
            updatecount="$updates Updates"
        fi
        printf " %s %s \n"  "^c#1e222a^^b#802a2a^$icon" "^c#1e222a^^b#ff5555^$updatecount"
        newtime=`expr $timestamp + 900`
        echo -e "LastUsed=${newtime}\nMessage='${updatecount}'" > $configFile
    else
        if [ "$timestamp" -ge "$LastUsed" ]; then
            updates=$(yay -Pn)
            if [ "$updates" -eq "0" ]; then
                updatecount="No Updates"
            elif [ "$updates" -ge "1" ]; then
                updatecount="$updates Update"
            else
                updatecount="$updates Updates"
            fi
            printf " %s %s \n"  "^c#1e222a^^b#802a2a^$icon" "^c#1e222a^^b#ff5555^$updatecount"
            newtime=`expr $timestamp + 900`
            echo -e "LastUsed=${newtime}\nMessage='${updatecount}'" > $configFile
        else
            updates=" $Message"
            printf " %s %s \n"  "^c#1e222a^^b#802a2a^$icon" "^c#1e222a^^b#ff5555^$updates"
        fi
    fi
}

updates
