#!/usr/bin/env bash

monitor=$1

workspaces() {
    coloractive='%{F#283036}%{B#a6fffc}'
    colorurgent='%{F#283036}%{B#ff5959}'
    colorinactive='%{F#283036}%{B#59fff9}'
    workspace_list=""

    length="$(i3-msg -t get_workspaces | jq -r '. | length')"
    for i in $(seq "$length"); do
        workspace=$(i3-msg -t get_workspaces | jq -j '.['"($i - 1)"']')
        if [ "$(echo "$workspace" | jq -r '.output')" == "${monitor}" ]; then
            if [ "$(echo "$workspace" | jq -r '.urgent')" = true ]; then
                workspace_list+="$colorurgent"
            elif [ "$(echo "$workspace" | jq -r '.focused')" != true ]; then
                workspace_list+="$colorinactive"
            else
                workspace_list+="$coloractive"
            fi
            if [ "$(echo "$workspace" | jq -r '.num')" == "1" ]; then
                workspace_list+=" ä¸€"
            fi
            ws=$(echo "$workspace" | jq -r '.name' | awk '{print $1,$2}')
            workspace_list+=" ${ws} "
        fi
    done
    echo "$workspace_list"
}

runme() {
    printf "%s\r" "$(workspaces)"
    sleep .1s
}

runme
